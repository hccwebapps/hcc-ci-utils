description: >
  Tags an image for ECR with the specified tags.
parameters:
  repo:
    type: string
    default: ${CIRCLE_PROJECT_REPONAME}
  source_tag:
    type: string
    default: circleci-app-runtime
  tags:
    type: string
    default: latest,${BRANCH},rev-${SHORT_GIT_HASH}
steps:
  - run: |
      IFS="," read -ra DOCKER_TAGS \<<< "<< parameters.tags >>"
      for tag in "${DOCKER_TAGS[@]}"; do
          docker tag << parameters.repo >>:<< parameters.source_tag >> ${AWS_ECR_ACCOUNT_URL}/<< parameters.repo >>:${tag}
      done
